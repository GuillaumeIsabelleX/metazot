jQuery(document).ready(function(){var o=!1;0<jQuery("#ZP_COLLECTION_ID").length&&(o=jQuery("#ZP_COLLECTION_ID").text());var l=!1;0<jQuery("#ZP_TAG_ID").length&&(l=jQuery("#ZP_TAG_ID").text());var n=!1;0<jQuery("#ZP_SHOWIMAGE").length&&("yes"==jQuery("#ZP_SHOWIMAGE").text()||"true"==jQuery("#ZP_SHOWIMAGE").text()||"1"==jQuery("#ZP_SHOWIMAGE").text())&&(n=!0);var p=!1;0<jQuery("#ZP_ISADMIN").length&&(p=!0);var a=!1;0<jQuery("#ZP_TARGET").length&&(a=!0);var r=!1;0<jQuery("#ZP_URLWRAP").length&&(r=jQuery("#ZP_URLWRAP").text());var u=!0;function d(){if(0!=jQuery("div.zp-List .csl-left-margin").length&&/\d/.test(jQuery("div.zp-List .csl-left-margin").text())){var e=1;jQuery("div.zp-List .csl-left-margin").each(function(){jQuery(this).text(jQuery(this).text().replace(/(\d+)/,e)),e++})}}0<jQuery("#zp-Browse-Collections-Select").length&&(!function a(e,t,r){void 0!==e&&"false"!=e&&""!=e||(e=0);void 0!==t&&"false"!=t&&""!=t||(t=0);jQuery.ajax({url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",api_user_id:jQuery("#ZP_API_USER_ID").text(),item_type:"collections",collection_id:o,request_start:e,request_last:t,sort_by:"title",get_top:!0,update:r,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(e){var t=jQuery.parseJSON(e),s="";!1===r&&jQuery("select#zp-Browse-Collections-Select").addClass("used_cache"),!0!==r||jQuery("select#zp-Browse-Collections-Select").hasClass("updating")||(jQuery("select#zp-Browse-Collections-Select").empty().addClass("updating"),l&&jQuery("select#zp-Browse-Collections-Select").append("<option value='blank'>--"+zpShortcodeAJAX.txt_nocollsel+"--</option>"),l||o||jQuery("select#zp-Browse-Collections-Select").append("<option value='toplevel'>"+zpShortcodeAJAX.txt_toplevel+"</option>")),o&&0==jQuery("#zp-Browse-Collections-Select option.toplevel").length&&jQuery("select#zp-Browse-Collections-Select").append("<option value='blank' class='blank'>"+jQuery("#ZP_COLLECTION_NAME").text()+"</option>\n"),"0"!=t&&0<t.data.length&&(jQuery.each(t.data,function(e,t){var a="<option value='"+t.key+"'";o==t.key&&(a+=" selected='selected'"),a+=">",o&&(a+="- "),a+=t.data.name+" (",0<t.meta.numCollections&&(a+=t.meta.numCollections+" "+zpShortcodeAJAX.txt_subcoll+", "),a+=t.meta.numItems+" "+zpShortcodeAJAX.txt_items+")</option>\n",s+=a}),jQuery("select#zp-Browse-Collections-Select").append(s),0!=t.meta.request_next&&"false"!=t.meta.request_next?a(t.meta.request_next,t.meta.request_last,r):jQuery("select#zp-Browse-Collections-Select").hasClass("updating")||a(0,0,!0)),o&&0==jQuery("#zp-Browse-Collections-Select option.toplevel").length&&jQuery("select#zp-Browse-Collections-Select").append("<option value='toplevel' class='toplevel'>"+zpShortcodeAJAX.txt_backtotop+"</option>\n"),jQuery("select#zp-Browse-Collections-Select").removeClass("loading").find(".loading").remove()},error:function(e){console.log("Error for zp_get_collections(): ",e.statusText)},complete:function(e,t){}})}(0,0,!1),function a(e,t,r){void 0!==e&&"false"!=e&&""!=e||(e=0);void 0!==t&&"false"!=t&&""!=t||(t=0);jQuery.ajax({url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",api_user_id:jQuery("#ZP_API_USER_ID").text(),item_type:"tags",is_dropdown:!0,maxtags:jQuery("#ZP_MAXTAGS").text(),request_start:e,request_last:t,update:r,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(e){var t=jQuery.parseJSON(e),s="<option id='zp-List-Tags-Select' name='zp-List-Tags-Select'>--"+zpShortcodeAJAX.txt_notagsel+"--</option>\n";l&&(s="<option value='toplevel' class='toplevel'>--"+zpShortcodeAJAX.txt_backtotop+"--</option>\n"),!1===r&&jQuery("select#zp-List-Tags").addClass("used_cache"),!0!==r||jQuery("select#zp-List-Tags").hasClass("updating")||jQuery("select#zp-List-Tags").empty().addClass("updating"),0!==t&&0<t.data.length?(jQuery.each(t.data,function(e,t){var a="<option class='zp-List-Tag' value='"+t.tag.replace(/ /g,"+")+"'";0<jQuery("#ZP_TAG_ID").length&&jQuery("#ZP_TAG_ID").text()==t.tag&&(a+=" selected='selected'"),a+=">"+t.tag+" ("+t.meta.numItems+" "+zpShortcodeAJAX.txt_items+")</option>\n",s+=a}),jQuery("select#zp-List-Tags").append(s),0!=t.meta.request_next&&"false"!=t.meta.request_next?a(t.meta.request_next,t.meta.request_last,r):jQuery("select#zp-List-Tags").hasClass("updating")||a(0,0,!0),jQuery("select#zp-List-Tags").removeClass("loading").find(".loading").remove()):(jQuery("select#zp-List-Tags").removeClass("loading").find(".loading").remove(),jQuery("select#zp-List-Tags").append("<option rel='empty' value='empty'>"+zpShortcodeAJAX.txt_notags+"</option>"))},error:function(e){console.log("Error for zp_get_tags(): ",e.statusText)},complete:function(e,t){}})}(0,0,!1),function s(e,t,i){void 0!==e&&"false"!=e&&""!=e||(e=0);void 0!==t&&"false"!=t&&""!=t||(t=0);jQuery(".zp-List").hasClass("loading")&&""==jQuery(".zp-List").find(".zp_display_progress").text()&&jQuery(".zp-List").append("<div class='zp_display_progress'>"+zpShortcodeAJAX.txt_loading+" ...</div>");jQuery.ajax({async:!0,url:zpShortcodeAJAX.ajaxurl,ifModified:!0,data:{action:"zpRetrieveViaShortcode",api_user_id:jQuery("#ZP_API_USER_ID").text(),is_dropdown:!0,item_type:"items",citeable:jQuery("#ZP_CITEABLE").text(),downloadable:jQuery("#ZP_DOWNLOADABLE").text(),showimage:jQuery("#ZP_SHOWIMAGE").text(),target:a,urlwrap:r,collection_id:o,tag_id:l,get_top:!0,sort_by:jQuery("#ZP_SORTBY").text(),order:jQuery("#ZP_ORDER").text(),update:i,request_start:e,request_last:t,zpShortcode_nonce:zpShortcodeAJAX.zpShortcode_nonce},xhrFields:{withCredentials:!0},success:function(e){var t=jQuery.parseJSON(e);if(!1===i?jQuery(".zp-List").addClass("used_cache"):!0===i&&(jQuery(".zp-List").hasClass("updating")||jQuery(".zp-List").addClass("updating")),void 0!==t&&null!=t&&0!=t&&0<t.data.length){var l="";if(jQuery(".zp-List").hasClass("updating")||!1===t.meta.request_last||"false"==t.meta.request_last||0===t.meta.request_last||jQuery(".zp-List").find(".zp_display_progress").html("Loading "+t.meta.request_next+"-"+(t.meta.request_next+50)+" out of "+(parseInt(t.meta.request_last)+50)+"..."),jQuery.each(t.data,function(e,t){var a="",s=jQuery("div.zp-List #zp-ID-"+t.library.id+"-"+t.key),r="0000";t.meta.hasOwnProperty("parsedDate")&&(r=t.meta.parsedDate.substring(0,4));var o=t.data.title;t.meta.hasOwnProperty("creatorSummary")&&(o=t.meta.creatorSummary.replace(/ /g,"-")),a+="<div id='zp-ID-"+t.library.id+"-"+t.key+"' class='zp-Entry zpSearchResultsItem hidden",!0===i&&(a+=" zp_updated"),a+="' data-zp-author-year='"+o+"-"+r+"'",a+="' data-zp-year-author='"+r+"-"+o+"'",a+=">\n",(p||n&&t.hasOwnProperty("image"))&&(a+="<div id='zp-Citation-"+t.key+"' class='zp-Entry-Image",t.hasOwnProperty("image")&&(a+=" hasImage"),a+="' rel='"+t.key+"'>\n",t.hasOwnProperty("image")&&(a+="<img class='thumb' src='"+t.image[0]+"' alt='image' />\n"),p&&(t.hasOwnProperty("image")?a+="<a title='Change Image' class='upload' rel='"+t.key+"' href='#'>"+zpShortcodeAJAX.txt_changeimg+"</a>\n":a+="<a title='Set Image' class='upload' rel='"+t.key+"' href='#'>"+zpShortcodeAJAX.txt_setimg+"</a>\n"),p&&t.hasOwnProperty("image")&&(a+="<a title='Remove Image' class='delete' rel='"+t.key+"' href='#'>&times;</a>\n"),a+="</div>\x3c!-- .zp-Entry-Image --\x3e\n"),a+=t.bib,p&&(a+="<label for='item_key'>"+zpShortcodeAJAX.txt_itemkey+":</label><input type='text' name='item_key' class='item_key' value='"+t.key+"'>\n"),a+="</div>\x3c!-- .zp-Entry --\x3e\n",0<s.length&&!0===i?s.replaceWith(jQuery(a)):l+=a}),!1===i&&jQuery("#zpSearchResultsContainer").append(l),0!=t.meta.request_next&&"false"!=t.meta.request_next)1==u?window.zpACPagination(u,!1):window.zpACPagination(u,!0),u=!1,d(),s(t.meta.request_next,t.meta.request_last,i);else if(window.zpACPagination(u),u=!1,jQuery(".zp-List").removeClass("loading"),jQuery(".zp-List").find(".zp_display_progress").remove(),jQuery("div.zp-List").hasClass("updating")){var a=jQuery("#ZP_SORTBY").text(),r=jQuery("#ZP_ORDER").text();if(-1!==["author","date"].indexOf(a)&&0==jQuery("div.zp-List .csl-left-margin").length){var o="data-zp-author-year";"date"==a&&(o="data-zp-year-author"),jQuery("#"+t.instance+" .zp-List div.zp-Entry").sort(function(e,t){var a=e.getAttribute(o).toLowerCase(),s=t.getAttribute(o).toLowerCase();return s<a?"asc"==r?1:-1:a<s?"asc"==r?-1:1:0}).detach().appendTo("#"+t.instance+" .zp-List")}d()}else s(0,0,!0)}else jQuery(".zp-List").removeClass("loading"),jQuery(".zp-List").find(".zp_display_progress").remove(),jQuery("#zpSearchResultsContainer").append("<p>"+zpShortcodeAJAX.txt_nocitations+"</p>\n")},error:function(e){console.log("Error for zp_get_items(): ",e.statusText)}})}(0,0,!1))});
